import{u as q,k as G,b as _,r as d,m as i,l as p,Q as x,j as e,d as n,_ as Q,R as z,P as J,f as K,c as T}from"./index-4820e760.js";import{u as W,I as X}from"./ImageUpload-9bb7eaa7.js";import{R as g}from"./Radio-6d0d2374.js";import{c as Y,a as y,u as Z,F as j,L as v,I as w,b as ee,o as se}from"./yup-7563acd1.js";import{H as ae}from"./Heading-03f78f57.js";import{B as re}from"./Button-f45348c8.js";import{u as r}from"./constants-c6ed1daf.js";import"./index.esm-5e753448.js";const te=Y({username:y().required("Please enter your username"),slug:y().lowercase()}),fe=()=>{const{userInfo:c}=q(),{control:o,handleSubmit:D,watch:S,setValue:F,getValues:b,reset:R,formState:{isValid:O,isSubmitting:E,errors:I}}=Z({mode:"onchange",resolver:se(te)}),[k]=G(),t=k.get("id"),A=_(),m=S("role"),h=b("avatar"),l=/%2F(\S+)\?/gm.exec(h),H=(l==null?void 0:l.length)>0?l[1]:"",{image:f,setImage:N,progress:M,handleSelectImage:P,handleDeleteImage:C}=W(F,b,H,B);d.useEffect(()=>{document.title="G19BLOG - Update User"},[]);const L=async s=>{if(O)try{const a=i(n,"users",t);await p(a,{...s,avatar:f});const u=Q(n,"posts"),V=z(u,J("user.id","==",c.uid));(await K(V)).forEach(async U=>{const $=i(n,"posts",U.id);await p($,{user:{...U.data().user,username:s.username,slug:s.slug,avatar:f}})}),x.success("Update user successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),A("/dashboard")}catch{x.error("Failed to update user !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}};async function B(){const s=i(n,"users",t);await p(s,{avatar:""})}return d.useEffect(()=>{N(h)},[h,N]),d.useEffect(()=>{async function s(){if(!t)return;const a=i(n,"users",t),u=await T(a);R(u&&u.data())}s()},[R,t]),d.useEffect(()=>{var a;const s=Object.values(I);s.length>0&&x.error((a=s[0])==null?void 0:a.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[I]),t?e.jsxs("div",{children:[e.jsx(ae,{children:"update user"}),e.jsxs("form",{className:"pt-14",onSubmit:D(L),children:[e.jsx("div",{className:"w-[300px] h-[300px] mx-auto rounded-full mb-16",children:e.jsx(X,{className:"!rounded-full h-full",onChange:P,handleDeleteImage:C,progress:M,image:f,userImage:"true"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(j,{children:[e.jsx(v,{children:"username ‚úíÔ∏è"}),e.jsx(w,{control:o,placeholder:"Enter your username",name:"username"})]}),e.jsxs(j,{children:[e.jsx(v,{children:"slug ‚úíÔ∏è"}),e.jsx(w,{control:o,placeholder:"Example: taketa-hana",name:"slug"})]})]}),e.jsx("div",{className:"grid grid-cols-2 mb-10 gap-x-10",children:(c==null?void 0:c.role)===r.ADMIN&&e.jsx(e.Fragment,{children:e.jsxs(j,{children:[e.jsx(v,{children:"role üìâ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(g,{name:"role",control:o,checked:m===r.ADMIN,value:r.ADMIN,children:"admin"}),e.jsx(g,{name:"role",control:o,checked:m===r.MOD,value:r.MOD,children:"mod"}),e.jsx(g,{name:"role",control:o,checked:m===r.USER,value:r.USER,children:"user"})]})]})})}),e.jsx(re,{type:"submit",kind:"secondary",className:`w-[200px] mx-auto h-[65px] font-semibold text-xl ${E?"opacity-50 pointer-events-none":""}`,children:E?e.jsx(ee,{}):"update user"})]})]}):null};export{fe as default};
