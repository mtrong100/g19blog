import{u as Y,b as W,k as X,r as o,Q as E,j as e,m as v,d as f,c as F,_ as Z,R as ee,P as te,f as se,l as ae}from"./index-4820e760.js";import{u as oe,I as re}from"./ImageUpload-9bb7eaa7.js";import{s as le}from"./slugify-796ef179.js";import{l as ne,I as ce,a as ie,D as de,S as me,L as ue,O as pe,R as he}from"./axios-f998d028.js";import{R as c}from"./Radio-6d0d2374.js";import{c as xe,a as fe,u as ge,F as i,L as d,I as je,b as be,o as Ee}from"./yup-7563acd1.js";import{H as ve}from"./Heading-03f78f57.js";import{B as we}from"./Button-f45348c8.js";import{u as T,a as m,p as u}from"./constants-c6ed1daf.js";import{B as ye,a as Se}from"./index.esm-48e361e7.js";import"./index.esm-5e753448.js";ne.Quill.register("modules/imageUploader",ce);const Ne=xe({title:fe().required("Please enter your title !")}),Be=()=>{const{userInfo:l}=Y(),B=W(),[H]=X(),p=H.get("id"),{control:r,handleSubmit:L,watch:w,setValue:y,getValues:g,reset:S,formState:{isValid:G,isSubmitting:N,errors:P}}=ge({mode:"onchange",resolver:Ee(Ne)}),R=g("image"),V=g("image_name"),j=w("status"),b=w("promote"),{image:D,setImage:k,progress:$,handleSelectImage:q,handleDeleteImage:_}=oe(y,g,V),[C,M]=o.useState([]),[n,I]=o.useState(""),[U,A]=o.useState("");o.useEffect(()=>{document.title="G19BLOG - Update Post"},[]),o.useEffect(()=>{async function t(){var x,h;if(!p)return;const s=v(f,"posts",p),a=await F(s);a.data()&&(S(a.data()),I(((x=a.data())==null?void 0:x.category)||""),A(((h=a.data())==null?void 0:h.content)||""))}t()},[p,S]),o.useEffect(()=>{async function t(){const s=Z(f,"categories"),a=ee(s,te("status","==","approved")),x=await se(a);let h=[];x.forEach(O=>{h.push({id:O.id,...O.data()})}),M(h)}t()},[]),o.useEffect(()=>{k(R)},[R,k]);const Q=async t=>{const s=v(f,"categories",t.id),a=await F(s);y("category",{id:a.id,...a.data()}),I(t)},z=async t=>{if(G)try{const s=v(f,"posts",p);t.slug=le(t.title,{lower:!0}),await ae(s,{...t,content:U,image:D}),E.success("Update post successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),B("/manage/post")}catch{E.error("Failed to update post !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}},J="9a11f0b1324b260553f2e8b764d9b2b1",K=o.useMemo(()=>({toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],imageUploader:{upload:async t=>{const s=new FormData;return s.append("image",t),(await ie({method:"post",url:`https://api.imgbb.com/1/upload?key=${J}`,data:s,headers:{"Content-Type":"multipath/form-data"}})).data.data.url}}}),[]);return o.useEffect(()=>{var s;const t=Object.values(P);t.length>0&&E.error((s=t[0])==null?void 0:s.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[P]),p?e.jsxs("div",{children:[e.jsx(ve,{children:"Update post"}),e.jsxs("form",{className:"pt-14",onSubmit:L(z),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(i,{children:[e.jsx(d,{children:"Title ‚úíÔ∏è"}),e.jsx(je,{control:r,placeholder:"Enter your title",name:"title"})]}),e.jsxs(i,{children:[e.jsx(d,{children:"Category üì¶"}),e.jsxs(de,{children:[e.jsx(me,{placeholder:"Select Category"}),e.jsx(ue,{children:C.length>0&&C.map(t=>e.jsx(pe,{onClick:()=>Q(t),children:t.title},t.id))})]}),(n==null?void 0:n.title)&&e.jsx("span",{className:"inline-block p-3 text-sm font-medium rounded-lg bg-colorGradient",children:`#${n==null?void 0:n.title}`})]})]}),e.jsxs("div",{className:"grid items-center grid-cols-2 mb-10 gap-x-10",children:[e.jsxs(i,{children:[e.jsx(d,{children:"Image üñºÔ∏è"}),e.jsx(re,{onChange:q,handleDeleteImage:_,progress:$,image:D}),e.jsx("input",{type:"file",name:"image",className:"hidden-input"})]}),e.jsx("div",{className:"flex flex-col gap-20",children:((l==null?void 0:l.role)===T.ADMIN||(l==null?void 0:l.role)===T.MOD)&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Promote Post ‚úÖ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(c,{name:"promote",control:r,checked:b===m.FEATURE,value:m.FEATURE,children:"Feature"}),e.jsx(c,{name:"promote",control:r,checked:b===m.BEST,value:m.BEST,children:"Best"}),e.jsx(c,{name:"promote",control:r,checked:b===m.HOT,value:m.HOT,children:"Hot"})]})]}),e.jsxs(i,{children:[e.jsx(d,{children:"Status üìâ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(c,{name:"status",control:r,checked:j===u.APPROVED,value:u.APPROVED,children:"Approved"}),e.jsx(c,{name:"status",control:r,checked:j===u.PENDING,value:u.PENDING,children:"Pending"}),e.jsx(c,{name:"status",control:r,checked:j===u.REJECTED,value:u.REJECTED,children:"Reject"})]})]})]})})]}),e.jsx("div",{className:"mb-10",children:e.jsxs(i,{children:[e.jsx(d,{children:"Content ‚úçÔ∏è"}),e.jsx("div",{className:"w-full entry-content",children:e.jsx(he,{modules:K,theme:"snow",value:U,onChange:A})})]})}),e.jsx(we,{id:"update-post",type:"submit",kind:"secondary",className:`w-[200px] mx-auto h-[65px] font-semibold text-xl ${N?"opacity-50 pointer-events-none":""}`,children:N?e.jsx(be,{}):"update post"})]}),e.jsx("a",{href:"#",children:e.jsx("div",{className:"fixed shadow-2xl w-[50px] h-[50px] rounded-full bottom-20 right-5 flex items-center justify-center bg-colorSecondary text-white z-40 cursor-pointer font-bold text-2xl",children:e.jsx(ye,{})})}),e.jsx("a",{href:"#update-post",children:e.jsx("div",{className:"fixed shadow-2xl w-[50px] h-[50px] rounded-full bottom-5 right-5 flex items-center justify-center bg-colorSecondary text-white z-40 cursor-pointer font-bold text-2xl",children:e.jsx(Se,{})})})]}):null};export{Be as default};
