import{u as z,b as W,k as X,r as o,Q as E,j as e,m as v,d as g,c as T,_ as Z,R as ee,P as se,f as te,l as ae}from"./index-1a09a758.js";import{u as oe,I as re}from"./ImageUpload-1f666887.js";import{s as ne}from"./slugify-6bdff1e7.js";import{l as le,I as ce,a as ie,D as de,S as me,L as ue,O as pe,R as he}from"./axios-791aca4c.js";import{R as c}from"./Radio-350b8511.js";import{c as xe,a as ge,u as fe,F as i,L as d,I as je,b as be,o as Ee}from"./yup-69894f34.js";import{H as ve}from"./Heading-4cff3cb1.js";import{B as Se}from"./Button-4df03686.js";import{u as A,a as m,p as u}from"./constants-c6ed1daf.js";import"./index.esm-42c3358b.js";le.Quill.register("modules/imageUploader",ce);const Pe=xe({title:ge().required("Please enter your title !")}),Fe=()=>{const{userInfo:n}=z(),H=W(),[B]=X(),p=B.get("id"),{control:r,handleSubmit:L,watch:S,setValue:P,getValues:f,reset:y,formState:{isValid:G,isSubmitting:R,errors:N}}=fe({mode:"onchange",resolver:Ee(Pe)}),D=f("image"),V=f("image_name"),j=S("status"),b=S("promote"),{image:k,setImage:w,progress:$,handleSelectImage:q,handleDeleteImage:_}=oe(P,f,V),[C,M]=o.useState([]),[l,I]=o.useState(""),[O,U]=o.useState("");o.useEffect(()=>{document.title="G19BLOG - Update Post"},[]),o.useEffect(()=>{async function s(){var x,h;if(!p)return;const t=v(g,"posts",p),a=await T(t);a.data()&&(y(a.data()),I(((x=a.data())==null?void 0:x.category)||""),U(((h=a.data())==null?void 0:h.content)||""))}s()},[p,y]),o.useEffect(()=>{async function s(){const t=Z(g,"categories"),a=ee(t,se("status","==","approved")),x=await te(a);let h=[];x.forEach(F=>{h.push({id:F.id,...F.data()})}),M(h)}s()},[]),o.useEffect(()=>{w(D)},[D,w]);const Q=async s=>{const t=v(g,"categories",s.id),a=await T(t);P("category",{id:a.id,...a.data()}),I(s)},J=async s=>{if(G)try{const t=v(g,"posts",p);s.slug=ne(s.title,{lower:!0}),await ae(t,{...s,content:O,image:k}),E.success("Update post successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),H("/manage/post")}catch{E.error("Failed to update post !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}},K="9a11f0b1324b260553f2e8b764d9b2b1",Y=o.useMemo(()=>({toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],imageUploader:{upload:async s=>{const t=new FormData;return t.append("image",s),(await ie({method:"post",url:`https://api.imgbb.com/1/upload?key=${K}`,data:t,headers:{"Content-Type":"multipath/form-data"}})).data.data.url}}}),[]);return o.useEffect(()=>{var t;const s=Object.values(N);s.length>0&&E.error((t=s[0])==null?void 0:t.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[N]),p?e.jsxs("div",{children:[e.jsx(ve,{children:"Update post"}),e.jsxs("form",{className:"pt-14",onSubmit:L(J),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(i,{children:[e.jsx(d,{children:"Title ‚úíÔ∏è"}),e.jsx(je,{control:r,placeholder:"Enter your title",name:"title"})]}),e.jsxs(i,{children:[e.jsx(d,{children:"Category üì¶"}),e.jsxs(de,{children:[e.jsx(me,{placeholder:"Select Category"}),e.jsx(ue,{children:C.length>0&&C.map(s=>e.jsx(pe,{onClick:()=>Q(s),children:s.title},s.id))})]}),(l==null?void 0:l.title)&&e.jsx("span",{className:"inline-block p-3 text-sm font-medium rounded-lg bg-colorGradient",children:`#${l==null?void 0:l.title}`})]})]}),e.jsxs("div",{className:"grid items-center grid-cols-2 mb-10 gap-x-10",children:[e.jsxs(i,{children:[e.jsx(d,{children:"Image üñºÔ∏è"}),e.jsx(re,{onChange:q,handleDeleteImage:_,progress:$,image:k}),e.jsx("input",{type:"file",name:"image",className:"hidden-input"})]}),e.jsx("div",{className:"flex flex-col gap-20",children:((n==null?void 0:n.role)===A.ADMIN||(n==null?void 0:n.role)===A.MOD)&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Promote Post ‚úÖ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(c,{name:"promote",control:r,checked:b===m.FEATURE,value:m.FEATURE,children:"Feature"}),e.jsx(c,{name:"promote",control:r,checked:b===m.BEST,value:m.BEST,children:"Best"}),e.jsx(c,{name:"promote",control:r,checked:b===m.HOT,value:m.HOT,children:"Hot"})]})]}),e.jsxs(i,{children:[e.jsx(d,{children:"Status üìâ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(c,{name:"status",control:r,checked:j===u.APPROVED,value:u.APPROVED,children:"Approved"}),e.jsx(c,{name:"status",control:r,checked:j===u.PENDING,value:u.PENDING,children:"Pending"}),e.jsx(c,{name:"status",control:r,checked:j===u.REJECTED,value:u.REJECTED,children:"Reject"})]})]})]})})]}),e.jsx("div",{className:"mb-10",children:e.jsxs(i,{children:[e.jsx(d,{children:"Content ‚úçÔ∏è"}),e.jsx("div",{className:"w-full entry-content",children:e.jsx(he,{modules:Y,theme:"snow",value:O,onChange:U})})]})}),e.jsx(Se,{type:"submit",kind:"secondary",className:`w-[200px] mx-auto h-[65px] font-semibold text-xl ${R?"opacity-50 pointer-events-none":""}`,children:R?e.jsx(be,{}):"update post"})]})]}):null};export{Fe as default};
