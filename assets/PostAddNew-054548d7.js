import{u as J,r,b as Y,Q as p,j as e,R as k,P as C,_ as y,d as g,f as A,y as z,K as W,m as X,c as Z}from"./index-1a09a758.js";import{u as ee,I as se}from"./ImageUpload-1f666887.js";import{s as te}from"./slugify-6bdff1e7.js";import{l as ae,I as oe,a as re,D as le,S as ne,L as ie,O as ce,R as de}from"./axios-791aca4c.js";import{R as i}from"./Radio-350b8511.js";import{c as me,a as ue,u as he,F as c,L as d,I as pe,b as ge,o as xe}from"./yup-69894f34.js";import{H as fe}from"./Heading-4cff3cb1.js";import{B as je}from"./Button-4df03686.js";import{u as O,a as m,p as u}from"./constants-c6ed1daf.js";import"./index.esm-42c3358b.js";ae.Quill.register("modules/imageUploader",oe);const be=me({title:ue().required("Please enter your title !")}),Ce=()=>{const{userInfo:a}=J(),{control:l,handleSubmit:F,watch:v,setValue:x,getValues:I,reset:T,formState:{isValid:H,isSubmitting:S,errors:w}}=he({mode:"onchange",resolver:xe(be),defaultValues:{title:"",slug:"",status:"pending",promote:"none",image:"",category:{},user:{}}}),f=v("status"),j=v("promote"),{image:b,progress:U,handleSelectImage:q,handleDeleteImage:L,handleResetUpLoad:V}=ee(x,I),[N,B]=r.useState([]),[n,P]=r.useState(""),[E,G]=r.useState("");r.useEffect(()=>{document.title="G19BLOG - Add New Post"},[]),r.useEffect(()=>{async function s(){if(!a.email)return;const t=k(y(g,"users"),C("email","==",a.email));(await A(t)).forEach(h=>{x("user",{id:h.id,...h.data()})})}s()},[a.email]),r.useEffect(()=>{async function s(){const t=y(g,"categories"),o=k(t,C("status","==","approved")),h=await A(o);let R=[];h.forEach(D=>{R.push({id:D.id,...D.data()})}),B(R)}s()},[]);const $=Y(),K=async s=>{if(!H||!b||!s.category||!E){p.error("Please fill full the option !",{theme:"colored",autoClose:2e3,pauseOnHover:!1});return}try{const t={...s};t.slug=te(s.slug||s.title,{lower:!0});const o=y(g,"posts");await z(o,{...t,image:b,content:E,createdAt:W()}),p.success("Add new post successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),$("/manage/post"),T({title:"",slug:"",status:"pending",promote:"none",image:"",category:{},user:{}}),V(),P({})}catch{p.error("Failed to add new post !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}},M=async s=>{const t=X(g,"categories",s.id),o=await Z(t);x("category",{id:o.id,...o.data()}),P(s)},Q="9a11f0b1324b260553f2e8b764d9b2b1",_=r.useMemo(()=>({toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],imageUploader:{upload:async s=>{const t=new FormData;return t.append("image",s),(await re({method:"post",url:`https://api.imgbb.com/1/upload?key=${Q}`,data:t,headers:{"Content-Type":"multipath/form-data"}})).data.data.url}}}),[]);return r.useEffect(()=>{var t;const s=Object.values(w);s.length>0&&p.error((t=s[0])==null?void 0:t.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[w]),e.jsxs("div",{children:[e.jsx(fe,{children:"add new post"}),e.jsxs("form",{className:"pt-14",onSubmit:F(K),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(c,{children:[e.jsx(d,{children:"Title ‚úíÔ∏è"}),e.jsx(pe,{control:l,placeholder:"Enter your title",name:"title"})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Category üì¶"}),e.jsxs(le,{children:[e.jsx(ne,{placeholder:"Select Category"}),e.jsx(ie,{children:N.length>0&&N.map(s=>e.jsx(ce,{onClick:()=>M(s),children:s.title},s.id))})]}),(n==null?void 0:n.title)&&e.jsx("span",{className:"inline-block p-3 text-sm font-medium rounded-lg bg-colorGradient",children:`#${n==null?void 0:n.title}`})]})]}),e.jsxs("div",{className:"grid items-center grid-cols-2 mb-10 gap-x-10",children:[e.jsxs(c,{children:[e.jsx(d,{children:"Image üñºÔ∏è"}),e.jsx(se,{onChange:q,handleDeleteImage:L,progress:U,image:b}),e.jsx("input",{type:"file",name:"image",className:"hidden-input"})]}),e.jsx("div",{className:"flex flex-col gap-10",children:((a==null?void 0:a.role)===O.ADMIN||(a==null?void 0:a.role)===O.MOD)&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Promote Post ‚úÖ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(i,{name:"promote",control:l,checked:j===m.FEATURE,value:m.FEATURE,children:"Feature"}),e.jsx(i,{name:"promote",control:l,checked:j===m.BEST,value:m.BEST,children:"Best"}),e.jsx(i,{name:"promote",control:l,checked:j===m.HOT,value:m.HOT,children:"Hot"})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Status üìâ"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(i,{name:"status",control:l,checked:f===u.APPROVED,value:u.APPROVED,children:"Approved"}),e.jsx(i,{name:"status",control:l,checked:f===u.PENDING,value:u.PENDING,children:"Pending"}),e.jsx(i,{name:"status",control:l,checked:f===u.REJECTED,value:u.REJECTED,children:"Reject"})]})]})]})})]}),e.jsx("div",{className:"mb-10",children:e.jsxs(c,{children:[e.jsx(d,{children:"Content ‚úçÔ∏è"}),e.jsx("div",{className:"w-full entry-content",children:e.jsx(de,{modules:_,theme:"snow",value:E,onChange:G})})]})}),e.jsx(je,{type:"submit",kind:"secondary",className:`w-[250px] mx-auto h-[65px] font-semibold text-xl ${S?"opacity-50 pointer-events-none":""}`,children:S?e.jsx(ge,{}):"add new post"})]})]})};export{Ce as default};
